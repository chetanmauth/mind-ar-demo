<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <title>MindAR Invitation</title>

    <!-- MindAR + A-Frame -->
    <script src="https://cdn.jsdelivr.net/npm/aframe@1.5.0/dist/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/mind-ar@1.2.5/dist/mindar-image-aframe.prod.js"></script>

    <style>
      html, body {
        margin: 0;
        padding: 0;
        overflow: hidden;
        height: 100%;
        background: #000;
      }
      #ar-scene {
        width: 100%;
        height: 100%;
      }
      .mindar-ui-overlay {
        position: fixed;
        top: 0; left: 0;
        width: 100%; height: 100%;
        pointer-events: none;
      }
    </style>
  </head>

  <body>
    <a-scene
      id="ar-scene"
      mindar-image="imageTargetSrc: https://chetanmauth.github.io/mind-ar-demo/assets/targets.mind; filterMinCF:0.001; filterBeta: 0.02"
      color-space="sRGB"
      embedded
      device-orientation-permission-ui="enabled: true"
      vr-mode-ui="enabled: false"
      renderer="antialias: true; precision: mediump;"
      gesture-detector
      arjs="sourceType: webcam; debugUIEnabled: false;"
    >
      <a-assets>
        <img id="invitation" src="https://chetanmauth.github.io/mind-ar-demo/assets/invitation.jpg" />
      </a-assets>

      <!-- Target -->
      <a-entity mindar-image-target="targetIndex: 0">
        <a-plane
          src="#invitation"
          position="0 0 0"
          rotation="0 0 0"
          width="1"
          height="1.4"
          smooth="true"
          shadow="receive: true"
        ></a-plane>
      </a-entity>

      <a-camera position="0 0 0" look-controls="enabled: false"></a-camera>
    </a-scene>

    <script>
      // ✅ Tap to trigger camera focus (works on most Android browsers)
      document.body.addEventListener("click", () => {
        const video = document.querySelector("video");
        if (video && video.srcObject) {
          const track = video.srcObject.getVideoTracks()[0];
          if (track && track.getCapabilities().focusMode) {
            track.applyConstraints({ advanced: [{ focusMode: "continuous" }] }).catch(() => {});
          }
        }
      });

      // ✅ Adjust camera feed for portrait mode
      window.addEventListener("resize", () => {
        const scene = document.querySelector("a-scene");
        if (scene && scene.renderer) {
          scene.renderer.setSize(window.innerWidth, window.innerHeight);
        }
      });
    </script>
  </body>
</html>
